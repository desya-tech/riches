name: Security Scan (SAST & DAST)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:

  # ======================
  # SAST JOB
  # ======================
  scansast:
    runs-on:
      - self-hosted

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set permission SAST
        run: chmod +x scansast.sh

      - name: Run SAST Scan
        run: ./scansast.sh
  
  # ======================
  # SCA JOB
  # ======================
  scansca:
    runs-on:
      - self-hosted
    # Kalau mau DAST jalan SETELAH SAST sukses
    needs: scansast

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set permission SCA
        run: chmod +x scansca.sh

      - name: Run SAST SCA
        run: ./scansca.sh


  # ======================
  # DAST JOB
  # ======================
  scandast:
    runs-on:
      - self-hosted

    # Kalau mau DAST jalan SETELAH SAST sukses
    needs: scansca

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set permission DAST
        run: chmod +x scandast.sh

      - name: Run DAST Scan
        run: ./scandast.sh
